import{a1 as U,q as Q,o as M,d as I,g as e,F as P,M as V,t as v,a2 as k,a3 as B,c as q,w as z,f as L,u as l,a4 as G,a5 as N,p as $,i as W,s as X,m as A,P as j,I as H,R as ee,B as x,e as C,v as te,J as se,n as J,a6 as ae,C as oe,x as ne,a7 as re}from"./vendor-8be1f5fb.js";import{_ as Z,u as ce,A as T}from"./index-bae5dedd.js";import{l as le}from"./el-loading-15d78e2b.js";const ie=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a{1,2}|A{1,2}|m{1,2}|s{1,2}|Z{1,2}|SSS/g;function de(t,r,s,d){let p=t<12?"AM":"PM";return d&&(p=p.split("").reduce((g,a)=>g+=`${a}.`,"")),s?p.toLowerCase():p}function ue(t,r,s={}){var d;const p=t.getFullYear(),g=t.getMonth(),a=t.getDate(),i=t.getHours(),_=t.getMinutes(),c=t.getSeconds(),h=t.getMilliseconds(),u=t.getDay(),m=(d=s.customMeridiem)!=null?d:de,D={YY:()=>String(p).slice(-2),YYYY:()=>p,M:()=>g+1,MM:()=>`${g+1}`.padStart(2,"0"),MMM:()=>t.toLocaleDateString(s.locales,{month:"short"}),MMMM:()=>t.toLocaleDateString(s.locales,{month:"long"}),D:()=>String(a),DD:()=>`${a}`.padStart(2,"0"),H:()=>String(i),HH:()=>`${i}`.padStart(2,"0"),h:()=>`${i%12||12}`.padStart(1,"0"),hh:()=>`${i%12||12}`.padStart(2,"0"),m:()=>String(_),mm:()=>`${_}`.padStart(2,"0"),s:()=>String(c),ss:()=>`${c}`.padStart(2,"0"),SSS:()=>`${h}`.padStart(3,"0"),d:()=>u,dd:()=>t.toLocaleDateString(s.locales,{weekday:"narrow"}),ddd:()=>t.toLocaleDateString(s.locales,{weekday:"short"}),dddd:()=>t.toLocaleDateString(s.locales,{weekday:"long"}),A:()=>m(i,_),AA:()=>m(i,_,!1,!0),a:()=>m(i,_,!0),aa:()=>m(i,_,!0,!0)};return r.replace(ie,(R,E)=>E||D[R]())}const he=t=>{let r=new Date().getTime(),s=Math.floor((r-t)/1e3),d="";return s<=30?d="刚刚":s<60?d=s+"秒前":s<3600?d=Math.floor(s/60)+"分钟前":s<86400?d=Math.floor(s/3600)+"小时前":s<2592e3?d=Math.floor(s/86400)+"天前":d=ue(new Date(t),"YYYY-MM-DD"),d};const F=t=>($("data-v-655a8f47"),t=t(),W(),t),pe={class:"books-wrapper"},_e={class:"wrapper"},ve=["onClick"],ge={class:"cover-img"},me=["src"],fe={class:"info"},Se={class:"name"},we={class:"sub"},Ae={class:"author"},Me={class:"tags"},Ie={class:"update-info"},ye=F(()=>e("div",{class:"dot"},"•",-1)),ke={class:"size"},Be=F(()=>e("div",{class:"dot"},"•",-1)),xe={class:"date"},Ce={class:"last-chapter"},De={__name:"BookItems",props:["books","isSearch"],emits:["bookClick"],setup(t,{emit:r}){const s=t;U(a=>({"713bfbbc":l(g)}));const d=a=>r("bookClick",G(a)),p=a=>/^data:/.test(a)?a:location.origin+"/cover?path="+encodeURIComponent(a),g=Q(()=>s.isSearch?"space-between":"flex-start");return(a,i)=>{const _=N;return M(),I("div",pe,[e("div",_e,[(M(!0),I(P,null,V(s.books,c=>{var h;return M(),I("div",{class:"book",key:c.bookUrl,onClick:u=>d(c)},[e("div",ge,[(M(),I("img",{class:"cover",src:p(c.coverUrl),key:c.coverUrl,alt:"",loading:"lazy"},null,8,me))]),e("div",fe,[e("div",Se,v(c.name),1),e("div",we,[e("div",Ae,v(c.author),1),k(e("div",Me,[(M(!0),I(P,null,V((h=c.kind)==null?void 0:h.split(",").slice(0,2),u=>(M(),q(_,{key:u},{default:z(()=>[L(v(u),1)]),_:2},1024))),128))],512),[[B,s.isSearch]]),k(e("div",Ie,[ye,e("div",ke,"共"+v(c.totalChapterNum)+"章",1),Be,e("div",xe,v(l(he)(c.lastCheckTime)),1)],512),[[B,!s.isSearch]])]),k(e("div",{class:"intro"},v(c.intro),513),[[B,s.isSearch]]),k(e("div",{class:"dur-chapter"}," 已读："+v(c.durChapterTitle),513),[[B,!s.isSearch]]),e("div",Ce,"最新："+v(c.latestChapterTitle),1)])],8,ve)}),128))])])}}},Re=Z(De,[["__scopeId","data-v-655a8f47"]]);const Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==";const Y=t=>($("data-v-0fc06008"),t=t(),W(),t),Te={class:"index-wrapper"},ze={class:"navigation-wrapper"},Le=Y(()=>e("div",{class:"navigation-title-wrapper"},[e("div",{class:"navigation-title"},"阅读"),e("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),Ye={class:"search-wrapper"},be={class:"bottom-wrapper"},Pe={class:"recent-wrapper"},Ve=Y(()=>e("div",{class:"recent-title"},"最近阅读",-1)),He={class:"reading-recent"},Je={class:"setting-wrapper"},Ne=Y(()=>e("div",{class:"setting-title"},"基本设定",-1)),$e={class:"setting-item"},We={class:"bottom-icons"},Ze={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},Fe={class:"bottom-icon"},Oe=["src"],Ke={__name:"BookShelf",setup(t){const r=ce(),{connectStatus:s,connectType:d,newConnect:p,shelf:g}=X(r),a=A({name:"尚无阅读记录",author:"",url:"",chapterIndex:0,chapterPos:0}),i=A(!1),_=A(null),c=A(null);j(i,o=>{var n;if(!o)return(n=c.value)==null?void 0:n.close();c.value=re.service({target:_.value,spinner:le,text:"正在获取书籍信息",lock:!0})});const h=A([]);H(()=>{h.value.length>0&&(i.value=!1)});const u=A(""),m=A(!1);H(()=>{if(!(m.value&&u.value!="")){if(m.value=!1,h.value=[],u.value==""){h.value=g.value;return}h.value=g.value.filter(o=>o.name.includes(u.value)||o.author.includes(u.value))}});const D=()=>{u.value!=""&&(h.value=[],r.clearSearchBooks(),i.value=!0,m.value=!0,T.search(u.value,o=>{try{r.setSearchBooks(JSON.parse(o)),r.searchBooks.forEach(n=>h.value.push(n))}catch(n){throw x.error("后端数据错误"),n}},()=>{i.value=!1,h.value.length==0&&x.info("搜索结果为空")}))},R=()=>{},E=ae(),O=async o=>{const{bookUrl:n,name:S,author:f,durChapterIndex:w=0,durChapterPos:y=0}=o;await T.saveBook(o),b(n,S,f,w,y)},b=(o,n,S,f,w)=>{n!=="尚无阅读记录"&&(sessionStorage.setItem("bookUrl",o),sessionStorage.setItem("bookName",n),sessionStorage.setItem("bookAuthor",S),sessionStorage.setItem("chapterIndex",f),sessionStorage.setItem("chapterPos",w),a.value={name:n,author:S,url:o,chapterIndex:f,chapterPos:w},localStorage.setItem("readingRecent",JSON.stringify(a.value)),E.push({path:"/chapter"}))};ee(async()=>{let o=localStorage.getItem("readingRecent");o!=null&&(a.value=JSON.parse(o),typeof a.value.chapterIndex>"u"&&(a.value.chapterIndex=0)),i.value=!0,K()});const K=()=>{T.getBookShelf().then(o=>{r.setConnectType("success"),o.data.isSuccess?r.addBooks(o.data.data.sort(function(n,S){var f=n.durChapterTime||0,w=S.durChapterTime||0;return w-f})):(x.error(o.data.errorMsg),i.value=!1),r.setConnectStatus("已连接 "),r.setNewConnect(!1)}).catch(function(o){throw i.value=!1,r.setConnectType("danger"),r.setConnectStatus("连接失败"),x.error("后端连接失败"),r.setNewConnect(!1),o})};return(o,n)=>{const S=oe,f=N,w=Re;return M(),I("div",Te,[e("div",ze,[Le,e("div",Ye,[C(S,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:l(u),"onUpdate:modelValue":n[0]||(n[0]=y=>te(u)?u.value=y:null),class:"search-input","prefix-icon":l(ne),onKeyup:se(D,["enter"])},null,8,["modelValue","prefix-icon","onKeyup"])]),e("div",be,[e("div",Pe,[Ve,e("div",He,[C(f,{type:l(a).name=="尚无阅读记录"?"warning":"",class:J(["recent-book",{"no-point":l(a).url==""}]),size:"large",onClick:n[1]||(n[1]=y=>b(l(a).url,l(a).name,l(a).author,l(a).chapterIndex,l(a).chapterPos))},{default:z(()=>[L(v(l(a).name),1)]),_:1},8,["type","class"])])]),e("div",Je,[Ne,e("div",$e,[C(f,{type:l(d),size:"large",class:J(["setting-connect",{"no-point":l(p)}]),onClick:R},{default:z(()=>[L(v(l(s)),1)]),_:1},8,["type","class"])])])]),e("div",We,[e("a",Ze,[e("div",Fe,[e("img",{src:l(Ee),alt:""},null,8,Oe)])])])]),e("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:_},[C(w,{books:l(h),onBookClick:O,isSearch:l(m)},null,8,["books","isSearch"])],512)])}}},Ge=Z(Ke,[["__scopeId","data-v-0fc06008"]]);export{Ge as default};
