import{a1 as Q,a2 as q,q as $,o as m,d as w,g as e,F as b,M as V,t as h,a3 as k,a4 as x,c as G,w as E,f as z,u as n,a5 as X,a6 as L,p as N,i as W,s as j,m as g,P as ee,I as P,R as te,B as y,e as C,v as se,J as ae,n as J,a7 as oe,C as ne,x as ce,a8 as re}from"./vendor-b52b0953.js";import{_ as Y,u as le,A as M}from"./index-cd2ecf19.js";import{l as ie}from"./el-loading-15d78e2b.js";const de=l=>{let c=new Date().getTime(),o=Math.floor((c-l)/1e3),d="";return o<=30?d="刚刚":o<60?d=o+"秒前":o<3600?d=Math.floor(o/60)+"分钟前":o<86400?d=Math.floor(o/3600)+"小时前":o<2592e3?d=Math.floor(o/86400)+"天前":d=Q(new Date(l),"YYYY-MM-DD"),d};const Z=l=>(N("data-v-655a8f47"),l=l(),W(),l),ue={class:"books-wrapper"},he={class:"wrapper"},pe=["onClick"],_e={class:"cover-img"},ve=["src"],fe={class:"info"},ge={class:"name"},me={class:"sub"},we={class:"author"},Ie={class:"tags"},Ae={class:"update-info"},Be=Z(()=>e("div",{class:"dot"},"•",-1)),Se={class:"size"},ke=Z(()=>e("div",{class:"dot"},"•",-1)),xe={class:"date"},ye={class:"last-chapter"},Ce={__name:"BookItems",props:["books","isSearch"],emits:["bookClick"],setup(l,{emit:c}){const o=l;q(s=>({"713bfbbc":n(I)}));const d=s=>c("bookClick",X(s)),R=s=>/^data:/.test(s)?s:location.origin+"/cover?path="+encodeURIComponent(s),I=$(()=>o.isSearch?"space-between":"flex-start");return(s,_)=>{const A=L;return m(),w("div",ue,[e("div",he,[(m(!0),w(b,null,V(o.books,r=>{var u;return m(),w("div",{class:"book",key:r.bookUrl,onClick:i=>d(r)},[e("div",_e,[(m(),w("img",{class:"cover",src:R(r.coverUrl),key:r.coverUrl,alt:"",loading:"lazy"},null,8,ve))]),e("div",fe,[e("div",ge,h(r.name),1),e("div",me,[e("div",we,h(r.author),1),k(e("div",Ie,[(m(!0),w(b,null,V((u=r.kind)==null?void 0:u.split(",").slice(0,2),i=>(m(),G(A,{key:i},{default:E(()=>[z(h(i),1)]),_:2},1024))),128))],512),[[x,o.isSearch]]),k(e("div",Ae,[Be,e("div",Se,"共"+h(r.totalChapterNum)+"章",1),ke,e("div",xe,h(n(de)(r.lastCheckTime)),1)],512),[[x,!o.isSearch]])]),k(e("div",{class:"intro"},h(r.intro),513),[[x,o.isSearch]]),k(e("div",{class:"dur-chapter"}," 已读："+h(r.durChapterTitle),513),[[x,!o.isSearch]]),e("div",ye,"最新："+h(r.latestChapterTitle),1)])],8,pe)}),128))])])}}},Re=Y(Ce,[["__scopeId","data-v-655a8f47"]]);const Me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==";const T=l=>(N("data-v-0fc06008"),l=l(),W(),l),Ee={class:"index-wrapper"},ze={class:"navigation-wrapper"},Te=T(()=>e("div",{class:"navigation-title-wrapper"},[e("div",{class:"navigation-title"},"阅读"),e("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),De={class:"search-wrapper"},be={class:"bottom-wrapper"},Ve={class:"recent-wrapper"},Pe=T(()=>e("div",{class:"recent-title"},"最近阅读",-1)),Je={class:"reading-recent"},Le={class:"setting-wrapper"},Ne=T(()=>e("div",{class:"setting-title"},"基本设定",-1)),We={class:"setting-item"},Ye={class:"bottom-icons"},Ze={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},He={class:"bottom-icon"},Oe=["src"],Fe={__name:"BookShelf",setup(l){const c=le(),{connectStatus:o,connectType:d,newConnect:R,shelf:I}=j(c),s=g({name:"尚无阅读记录",author:"",url:"",chapterIndex:0,chapterPos:0}),_=g(!1),A=g(null),r=g(null);ee(_,t=>{var a;if(!t)return(a=r.value)==null?void 0:a.close();r.value=re.service({target:A.value,spinner:ie,text:"正在获取书籍信息",lock:!0})});const u=g([]);P(()=>{u.value.length>0&&(_.value=!1)});const i=g(""),B=g(!1);P(()=>{if(!(B.value&&i.value!="")){if(B.value=!1,u.value=[],i.value==""){u.value=I.value;return}u.value=I.value.filter(t=>t.name.includes(i.value)||t.author.includes(i.value))}});const H=()=>{i.value!=""&&(u.value=[],c.clearSearchBooks(),_.value=!0,B.value=!0,M.search(i.value,t=>{try{c.setSearchBooks(JSON.parse(t)),c.searchBooks.forEach(a=>u.value.push(a))}catch(a){throw y.error("后端数据错误"),a}},()=>{_.value=!1,u.value.length==0&&y.info("搜索结果为空")}))},O=()=>{},F=oe(),K=async t=>{const{bookUrl:a,name:v,author:p,durChapterIndex:f=0,durChapterPos:S=0}=t;await M.saveBook(t),D(a,v,p,f,S)},D=(t,a,v,p,f)=>{a!=="尚无阅读记录"&&(sessionStorage.setItem("bookUrl",t),sessionStorage.setItem("bookName",a),sessionStorage.setItem("bookAuthor",v),sessionStorage.setItem("chapterIndex",p),sessionStorage.setItem("chapterPos",f),s.value={name:a,author:v,url:t,chapterIndex:p,chapterPos:f},localStorage.setItem("readingRecent",JSON.stringify(s.value)),F.push({path:"/chapter"}))};te(async()=>{let t=localStorage.getItem("readingRecent");t!=null&&(s.value=JSON.parse(t),typeof s.value.chapterIndex>"u"&&(s.value.chapterIndex=0)),_.value=!0,U()});const U=()=>{M.getBookShelf().then(t=>{c.setConnectType("success"),t.data.isSuccess?c.addBooks(t.data.data.sort(function(a,v){var p=a.durChapterTime||0,f=v.durChapterTime||0;return f-p})):(y.error(t.data.errorMsg),_.value=!1),c.setConnectStatus("已连接 "),c.setNewConnect(!1)}).catch(function(t){throw _.value=!1,c.setConnectType("danger"),c.setConnectStatus("连接失败"),y.error("后端连接失败"),c.setNewConnect(!1),t})};return(t,a)=>{const v=ne,p=L,f=Re;return m(),w("div",Ee,[e("div",ze,[Te,e("div",De,[C(v,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:n(i),"onUpdate:modelValue":a[0]||(a[0]=S=>se(i)?i.value=S:null),class:"search-input","prefix-icon":n(ce),onKeyup:ae(H,["enter"])},null,8,["modelValue","prefix-icon","onKeyup"])]),e("div",be,[e("div",Ve,[Pe,e("div",Je,[C(p,{type:n(s).name=="尚无阅读记录"?"warning":"",class:J(["recent-book",{"no-point":n(s).url==""}]),size:"large",onClick:a[1]||(a[1]=S=>D(n(s).url,n(s).name,n(s).author,n(s).chapterIndex,n(s).chapterPos))},{default:E(()=>[z(h(n(s).name),1)]),_:1},8,["type","class"])])]),e("div",Le,[Ne,e("div",We,[C(p,{type:n(d),size:"large",class:J(["setting-connect",{"no-point":n(R)}]),onClick:O},{default:E(()=>[z(h(n(o)),1)]),_:1},8,["type","class"])])])]),e("div",Ye,[e("a",Ze,[e("div",He,[e("img",{src:n(Me),alt:""},null,8,Oe)])])])]),e("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:A},[C(f,{books:n(u),onBookClick:K,isSearch:n(B)},null,8,["books","isSearch"])],512)])}}},qe=Y(Fe,[["__scopeId","data-v-0fc06008"]]);export{qe as default};
