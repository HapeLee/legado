import{a0 as q,m as B,o as h,d as p,g as t,F as J,M as b,t as g,c as G,w as L,f as M,J as x,u as n,a1 as Z,v as S,a2 as X,L as j,a3 as $,Q as ee,j as w,e as E,x as te,I as se,p as z,a4 as oe,D as ae,y as ne}from"./vendor-Blq-ceJ6.js";import{d as re,i as ce,u as ie}from"./loading-F0lQefyD.js";import{_ as D,A as m,u as le}from"./index-DmLQnM_t.js";const de={class:"books-wrapper"},ue={class:"wrapper"},he=["onClick"],pe={class:"cover-img"},ge=["src"],me={class:"info"},ve={class:"name"},fe={class:"sub"},_e={class:"author"},we={key:0,class:"tags"},Be={key:1,class:"update-info"},Ae={class:"size"},Ce={class:"date"},Ie={key:0,class:"intro"},ye={key:1,class:"dur-chapter"},ke={class:"last-chapter"},xe={__name:"BookItems",props:["books","isSearch"],emits:["bookClick"],setup(v,{emit:s}){q(i=>({"6068553a":n(T)}));const C=v,r=s,I=i=>r("bookClick",i),R=i=>ce(i)?m.getProxyCoverUrl(i):i,y=i=>{i.target.src=m.getProxyCoverUrl(i.target.src)},T=B(()=>C.isSearch?"space-between":"flex-start");return(i,l)=>{const k=Z;return h(),p("div",de,[t("div",ue,[(h(!0),p(J,null,b(v.books,a=>{var f;return h(),p("div",{class:"book",key:a.bookUrl,onClick:A=>I(a)},[t("div",pe,[(h(),p("img",{class:"cover",src:R(a.coverUrl),key:a.coverUrl,onErrorOnce:y,alt:"",loading:"lazy"},null,40,ge))]),t("div",me,[t("div",ve,g(a.name),1),t("div",fe,[t("div",_e,g(a.author),1),v.isSearch?(h(),p("div",we,[(h(!0),p(J,null,b((f=a.kind)==null?void 0:f.split(",").slice(0,2),A=>(h(),G(k,{key:A},{default:L(()=>[M(g(A),1)]),_:2},1024))),128))])):x("",!0),v.isSearch?x("",!0):(h(),p("div",Be,[l[0]||(l[0]=t("div",{class:"dot"},"•",-1)),t("div",Ae,"共"+g(a.totalChapterNum)+"章",1),l[1]||(l[1]=t("div",{class:"dot"},"•",-1)),t("div",Ce,g(n(re)(a.lastCheckTime)),1)]))]),v.isSearch?(h(),p("div",Ie,g(a.intro),1)):x("",!0),v.isSearch?x("",!0):(h(),p("div",ye," 已读："+g(a.durChapterTitle),1)),t("div",ke,"最新："+g(a.latestChapterTitle),1)])],8,he)}),128))])])}}},Se=D(xe,[["__scopeId","data-v-136fc284"]]),Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==",Re={class:"navigation-wrapper"},Te={class:"search-wrapper"},ze={class:"bottom-wrapper"},Le={class:"recent-wrapper"},Me={class:"reading-recent"},Pe={class:"setting-wrapper"},Ne={class:"setting-item"},Ve={class:"bottom-icons"},Je={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},be={class:"bottom-icon"},Ze=["src"],De={__name:"BookShelf",setup(v){const s=le(),C=B(()=>s.isNight),r=S({name:"尚无阅读记录",author:"",url:"",chapterIndex:0,chapterPos:0}),I=S(null),{showLoading:R,closeLoading:y,loadingWrapper:T,isLoading:i}=ie(I,"正在获取书籍信息"),l=X([]),k=B(()=>s.shelf),a=S(""),f=S(!1);j(()=>{if(!(f.value&&a.value!="")){if(f.value=!1,l.value=[],a.value==""){l.value=k.value;return}l.value=k.value.filter(o=>o.name.includes(a.value)||o.author.includes(a.value))}});const A=()=>{a.value!=""&&(l.value=[],s.clearSearchBooks(),R(),f.value=!0,m.search(a.value,o=>{i&&y();try{s.setSearchBooks(JSON.parse(o)),l.value=s.searchBooks}catch(e){throw w.error("后端数据错误"),e}},()=>{y(),l.value.length==0&&w.info("搜索结果为空")}))},W=B(()=>s.connectStatus),H=B(()=>s.connectType),O=B(()=>s.newConnect),U=()=>{oe.prompt("请输入 IP 和端口 ( 如：127.0.0.1:9527 或者通过内网穿透的地址)","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?:([1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-6][0-5][0-5][0-3][0-5])$/,inputErrorMessage:"url 形式不正确",beforeClose:(o,e,u)=>{if(o==="confirm"){s.setNewConnect(!0),e.confirmButtonLoading=!0,e.confirmButtonText="校验中……";const c=e.inputValue;m.testLeagdoHttpUrlConnection("http://"+c).then(function(d){Q(d),e.confirmButtonLoading=!1,s.setConnectType("success"),s.setConnectStatus("已连接 "+c),s.clearSearchBooks(),s.setNewConnect(!1),m.setLeagdoHttpUrl("http://"+c),localStorage.setItem("remoteIp",c),N(),u()}).catch(function(d){throw e.confirmButtonLoading=!1,e.confirmButtonText="确定",w.error("访问失败，请检查您输入的 url"),s.setNewConnect(!1),d})}else u()}})},F=$(),K=async o=>{const{bookUrl:e,name:u,author:c,durChapterIndex:d=0,durChapterPos:_=0}=o,V="respondTime"in o;V&&await m.saveBook(o),P(e,u,c,d,_,V)},P=(o,e,u,c,d,_)=>{e!=="尚无阅读记录"&&(sessionStorage.setItem("bookUrl",o),sessionStorage.setItem("bookName",e),sessionStorage.setItem("bookAuthor",u),sessionStorage.setItem("chapterIndex",c),sessionStorage.setItem("chapterPos",d),sessionStorage.setItem("isSeachBook",_),r.value={name:e,author:u,url:o,chapterIndex:c,chapterPos:d},localStorage.setItem("readingRecent",JSON.stringify(r.value)),F.push({path:"/chapter"}))},Y=()=>{T(s.saveBookProgress().finally(N))},Q=o=>{try{s.setConfig(JSON.parse(o))}catch{w.info("阅读界面解析错误")}},N=()=>m.getBookShelf().then(o=>{s.setConnectType("success"),o.data.isSuccess?s.addBooks(o.data.data.sort(function(e,u){var c=e.durChapterTime||0,d=u.durChapterTime||0;return d-c})):w.error(o.data.errorMsg??"后端返回格式错误！"),s.setConnectStatus("已连接 "+m.legado_http_origin),s.setNewConnect(!1)});return ee(()=>{let o=localStorage.getItem("readingRecent");o!=null&&(r.value=JSON.parse(o),typeof r.value.chapterIndex>"u"&&(r.value.chapterIndex=0)),m.testLeagdoHttpUrlConnection().then(Y).catch(function(e){throw s.setConnectType("danger"),s.setConnectStatus("连接异常"),w.error("后端连接失败异常，请检查阅读WEB服务或者设置其它可用IP"),s.setNewConnect(!1),e})}),(o,e)=>{const u=ae,c=Z,d=Se;return h(),p("div",{class:z({"index-wrapper":!0,night:n(C),day:!n(C)})},[t("div",Re,[e[4]||(e[4]=t("div",{class:"navigation-title-wrapper"},[t("div",{class:"navigation-title"},"阅读"),t("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),t("div",Te,[E(u,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:n(a),"onUpdate:modelValue":e[0]||(e[0]=_=>te(a)?a.value=_:null),class:"search-input","prefix-icon":n(ne),onKeyup:se(A,["enter"])},null,8,["modelValue","prefix-icon"])]),t("div",ze,[t("div",Le,[e[2]||(e[2]=t("div",{class:"recent-title"},"最近阅读",-1)),t("div",Me,[E(c,{type:n(r).name=="尚无阅读记录"?"warning":"primary",class:z(["recent-book",{"no-point":n(r).url==""}]),size:"large",onClick:e[1]||(e[1]=_=>P(n(r).url,n(r).name,n(r).author,n(r).chapterIndex,n(r).chapterPos))},{default:L(()=>[M(g(n(r).name),1)]),_:1},8,["type","class"])])]),t("div",Pe,[e[3]||(e[3]=t("div",{class:"setting-title"},"基本设定",-1)),t("div",Ne,[E(c,{type:n(H),size:"large",class:z(["setting-connect",{"no-point":n(O)}]),onClick:U},{default:L(()=>[M(g(n(W)),1)]),_:1},8,["type","class"])])])]),t("div",Ve,[t("a",Je,[t("div",be,[t("img",{src:n(Ee),alt:""},null,8,Ze)])])])]),t("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:I},[E(d,{books:n(l),onBookClick:K,isSearch:n(f)},null,8,["books","isSearch"])],512)],2)}}},Ue=D(De,[["__scopeId","data-v-cdefedfd"]]);export{Ue as default};
