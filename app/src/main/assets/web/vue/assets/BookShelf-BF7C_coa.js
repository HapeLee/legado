import{a0 as q,m as w,o as h,d as p,g as t,F as b,M as J,t as g,c as G,w as L,f as M,J as x,u as n,a1 as Z,v as S,a2 as X,L as j,a3 as $,Q as ee,j as A,e as R,x as te,I as se,p as z,a4 as ae,D as oe,y as ne}from"./vendor-wTuFzYxX.js";import{d as re,i as ce,u as ie}from"./el-message-box-Bcaa4bya.js";import{_ as D,A as m,u as le}from"./index-lBr1IOP-.js";const de={class:"books-wrapper"},ue={class:"wrapper"},he=["onClick"],pe={class:"cover-img"},ge=["src"],me={class:"info"},fe={class:"name"},ve={class:"sub"},_e={class:"author"},we={key:0,class:"tags"},Be={key:1,class:"update-info"},Ae={class:"size"},Ce={class:"date"},Ie={key:0,class:"intro"},ke={key:1,class:"dur-chapter"},ye={class:"last-chapter"},xe={__name:"BookItems",props:["books","isSearch"],emits:["bookClick"],setup(f,{emit:s}){q(l=>({f19573ba:n(T)}));const C=f,r=s,I=l=>r("bookClick",l),E=l=>ce(l)?m.getProxyCoverUrl(l):l,k=l=>{l.target.src=m.getProxyCoverUrl(l.target.src)},T=w(()=>C.isSearch?"space-between":"flex-start");return(l,d)=>{const y=Z;return h(),p("div",de,[t("div",ue,[(h(!0),p(b,null,J(f.books,o=>{var v;return h(),p("div",{class:"book",key:o.bookUrl,onClick:B=>I(o)},[t("div",pe,[(h(),p("img",{class:"cover",src:E(o.coverUrl),key:o.coverUrl,onErrorOnce:k,alt:"",loading:"lazy"},null,40,ge))]),t("div",me,[t("div",fe,g(o.name),1),t("div",ve,[t("div",_e,g(o.author),1),f.isSearch?(h(),p("div",we,[(h(!0),p(b,null,J((v=o.kind)==null?void 0:v.split(",").slice(0,2),B=>(h(),G(y,{key:B},{default:L(()=>[M(g(B),1)]),_:2},1024))),128))])):x("",!0),f.isSearch?x("",!0):(h(),p("div",Be,[d[0]||(d[0]=t("div",{class:"dot"},"•",-1)),t("div",Ae,"共"+g(o.totalChapterNum)+"章",1),d[1]||(d[1]=t("div",{class:"dot"},"•",-1)),t("div",Ce,g(n(re)(o.lastCheckTime)),1)]))]),f.isSearch?(h(),p("div",Ie,g(o.intro),1)):x("",!0),f.isSearch?x("",!0):(h(),p("div",ke," 已读："+g(o.durChapterTitle),1)),t("div",ye,"最新："+g(o.latestChapterTitle),1)])],8,he)}),128))])])}}},Se=D(xe,[["__scopeId","data-v-1139d638"]]),Re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==",Ee={class:"navigation-wrapper"},Te={class:"search-wrapper"},ze={class:"bottom-wrapper"},Le={class:"recent-wrapper"},Me={class:"reading-recent"},Pe={class:"setting-wrapper"},Ne={class:"setting-item"},Ve={class:"bottom-icons"},be={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},Je={class:"bottom-icon"},Ze=["src"],De={__name:"BookShelf",setup(f){const s=le(),C=w(()=>s.isNight),r=S({name:"尚无阅读记录",author:"",url:"",chapterIndex:0,chapterPos:0}),I=S(null),{showLoading:E,closeLoading:k,loadingWrapper:T,isLoading:l}=ie(I,"正在获取书籍信息"),d=X([]),y=w(()=>s.shelf),o=S(""),v=S(!1);j(()=>{if(!(v.value&&o.value!="")){if(v.value=!1,d.value=[],o.value==""){d.value=y.value;return}d.value=y.value.filter(a=>a.name.includes(o.value)||a.author.includes(o.value))}});const B=()=>{o.value!=""&&(d.value=[],s.clearSearchBooks(),E(),v.value=!0,m.search(o.value,a=>{l&&k();try{s.setSearchBooks(JSON.parse(a)),d.value=s.searchBooks}catch(e){throw A.error("后端数据错误"),e}},()=>{k(),d.value.length==0&&A.info("搜索结果为空")}))},W=w(()=>s.connectStatus),H=w(()=>s.connectType),O=w(()=>s.newConnect),U=()=>{ae.prompt("请输入 IP 和端口 ( 如：127.0.0.1:9527 或者通过内网穿透的地址)","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?:([1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-6][0-5][0-5][0-3][0-5])$/,inputErrorMessage:"url 形式不正确",beforeClose:(a,e,i)=>{if(a==="confirm"){s.setNewConnect(!0),e.confirmButtonLoading=!0,e.confirmButtonText="校验中……";const c=e.inputValue;m.testLeagdoHttpUrlConnection("http://"+c).then(function(u){e.confirmButtonLoading=!1,s.setConnectType("success"),s.setConnectStatus("已连接 "+c),s.clearSearchBooks(),s.setNewConnect(!1),m.setLeagdoHttpUrl("http://"+c),localStorage.setItem("remoteIp",c),N(),i()}).catch(function(u){throw e.confirmButtonLoading=!1,e.confirmButtonText="确定",A.error("访问失败，请检查您输入的 url"),s.setNewConnect(!1),u})}else i()}})},F=$(),K=async a=>{const{bookUrl:e,name:i,author:c,durChapterIndex:u=0,durChapterPos:_=0}=a,V="respondTime"in a;V&&await m.saveBook(a),P(e,i,c,u,_,V)},P=(a,e,i,c,u,_)=>{e!=="尚无阅读记录"&&(sessionStorage.setItem("bookUrl",a),sessionStorage.setItem("bookName",e),sessionStorage.setItem("bookAuthor",i),sessionStorage.setItem("chapterIndex",c),sessionStorage.setItem("chapterPos",u),sessionStorage.setItem("isSeachBook",_),r.value={name:e,author:i,url:a,chapterIndex:c,chapterPos:u},localStorage.setItem("readingRecent",JSON.stringify(r.value)),F.push({path:"/chapter"}))};ee(()=>{let a=localStorage.getItem("readingRecent");a!=null&&(r.value=JSON.parse(a),typeof r.value.chapterIndex>"u"&&(r.value.chapterIndex=0)),m.testLeagdoHttpUrlConnection().then(Q).then(Y).catch(function(e){throw s.setConnectType("danger"),s.setConnectStatus("连接异常"),A.error("后端连接失败异常，请检查阅读WEB服务或者设置其它可用IP"),s.setNewConnect(!1),e})});const Y=()=>{T(s.saveBookProgress().finally(N))},N=()=>m.getBookShelf().then(a=>{s.setConnectType("success"),a.data.isSuccess?s.addBooks(a.data.data.sort(function(e,i){var c=e.durChapterTime||0,u=i.durChapterTime||0;return u-c})):A.error(a.data.errorMsg??"后端返回格式错误！"),s.setConnectStatus("已连接 "+m.legado_http_origin),s.setNewConnect(!1)}),Q=()=>m.getReadConfig().then(a=>{var e=a.data.data;if(e){let i=JSON.parse(e);s.setConfig(i)}});return(a,e)=>{const i=oe,c=Z,u=Se;return h(),p("div",{class:z({"index-wrapper":!0,night:n(C),day:!n(C)})},[t("div",Ee,[e[4]||(e[4]=t("div",{class:"navigation-title-wrapper"},[t("div",{class:"navigation-title"},"阅读"),t("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),t("div",Te,[R(i,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:n(o),"onUpdate:modelValue":e[0]||(e[0]=_=>te(o)?o.value=_:null),class:"search-input","prefix-icon":n(ne),onKeyup:se(B,["enter"])},null,8,["modelValue","prefix-icon"])]),t("div",ze,[t("div",Le,[e[2]||(e[2]=t("div",{class:"recent-title"},"最近阅读",-1)),t("div",Me,[R(c,{type:n(r).name=="尚无阅读记录"?"warning":"primary",class:z(["recent-book",{"no-point":n(r).url==""}]),size:"large",onClick:e[1]||(e[1]=_=>P(n(r).url,n(r).name,n(r).author,n(r).chapterIndex,n(r).chapterPos))},{default:L(()=>[M(g(n(r).name),1)]),_:1},8,["type","class"])])]),t("div",Pe,[e[3]||(e[3]=t("div",{class:"setting-title"},"基本设定",-1)),t("div",Ne,[R(c,{type:n(H),size:"large",class:z(["setting-connect",{"no-point":n(O)}]),onClick:U},{default:L(()=>[M(g(n(W)),1)]),_:1},8,["type","class"])])])]),t("div",Ve,[t("a",be,[t("div",Je,[t("img",{src:n(Re),alt:""},null,8,Ze)])])])]),t("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:I},[R(u,{books:n(d),onBookClick:K,isSearch:n(v)},null,8,["books","isSearch"])],512)],2)}}},Ue=D(De,[["__scopeId","data-v-21bbf1bf"]]);export{Ue as default};
